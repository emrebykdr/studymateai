<Page x:Class="StudyMateAI.Views.VideoPlayerPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
      Background="{DynamicResource MaterialDesignPaper}">
    
    <Grid Margin="20">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="250"/>
        </Grid.ColumnDefinitions>
        
        <!-- Main Content -->
        <Grid Grid.Column="0" Margin="0,0,16,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="300"/>
            </Grid.RowDefinitions>

        <!-- Header -->
        <materialDesign:Card Grid.Row="0" Padding="16" Margin="0,0,0,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock Text="Video Oynatıcı" FontSize="24" FontWeight="Bold"/>
                    <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                        <TextBox x:Name="UrlTextBox"
                                 materialDesign:HintAssist.Hint="YouTube Video URL'si"
                                 Width="400"
                                 Margin="0,0,8,0"
                                 Text="{Binding VideoUrl, UpdateSourceTrigger=PropertyChanged}"/>
                        <Button Content="Yükle"
                                Command="{Binding LoadVideoCommand}"
                                Margin="0,0,8,0"/>
                        <Button Content="Kaydet"
                                Command="{Binding SaveVideoCommand}"/>
                    </StackPanel>
                </StackPanel>

                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock Text="{Binding CurrentVideo.Title}" FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding CurrentVideo.Duration, StringFormat='Süre: {0} dk'}" 
                               Foreground="Gray" 
                               FontSize="11"/>
                </StackPanel>
            </Grid>
        </materialDesign:Card>

        <!-- Video Player -->
        <materialDesign:Card Grid.Row="1" Padding="0" Margin="0,0,0,16">
            <Grid>
                <wv2:WebView2 x:Name="VideoWebView"/>
                
                <!-- Zoom Controls Overlay -->
                <StackPanel HorizontalAlignment="Right" 
                           VerticalAlignment="Bottom" 
                           Margin="16"
                           Orientation="Horizontal"
                           Background="#CC000000"
                           Padding="8">
                    <Button x:Name="ZoomOutButton"
                            Content="-"
                            ToolTip="Zoom Out"
                            Margin="0,0,4,0"
                            Width="32"
                            Height="32"
                            FontSize="18"
                            FontWeight="Bold"
                            Click="ZoomOutButton_Click"/>
                    
                    <Slider x:Name="ZoomSlider"
                            Minimum="0.5"
                            Maximum="2.0"
                            Value="1.0"
                            Width="120"
                            VerticalAlignment="Center"
                            Margin="0,0,4,0"
                            ToolTip="{Binding Value, RelativeSource={RelativeSource Self}, StringFormat='Zoom: {0:P0}'}"
                            ValueChanged="ZoomSlider_ValueChanged"/>
                    
                    <Button x:Name="ZoomInButton"
                            Content="+"
                            ToolTip="Zoom In"
                            Margin="0,0,4,0"
                            Width="32"
                            Height="32"
                            FontSize="18"
                            FontWeight="Bold"
                            Click="ZoomInButton_Click"/>
                    
                    <Button x:Name="ResetZoomButton"
                            Content="⟲"
                            ToolTip="Reset Zoom"
                            Width="32"
                            Height="32"
                            FontSize="18"
                            Click="ResetZoomButton_Click"/>
                </StackPanel>
            </Grid>
        </materialDesign:Card>

        <!-- AI Chat Panel -->
        <materialDesign:Card Grid.Row="2" Padding="16">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" 
                           Text="AI Asistan - Video Hakkında Soru Sorun" 
                           FontSize="16" 
                           FontWeight="SemiBold" 
                           Margin="0,0,0,12"/>

                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <ItemsControl ItemsSource="{Binding ChatMessages}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Padding="8" Margin="0,4">
                                    <StackPanel>
                                        <TextBlock Text="{Binding Role}" 
                                                   FontWeight="Bold" 
                                                   Foreground="{DynamicResource PrimaryHueMidBrush}"/>
                                        <TextBlock Text="{Binding Content}" 
                                                   TextWrapping="Wrap" 
                                                   Margin="0,4,0,0"/>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <Grid Grid.Row="2" Margin="0,12,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBox Grid.Column="0"
                             x:Name="QuestionTextBox"
                             materialDesign:HintAssist.Hint="Sorunuzu yazın..."
                             Text="{Binding CurrentQuestion, UpdateSourceTrigger=PropertyChanged}"
                             AcceptsReturn="False"/>
                    
                    <Button Grid.Column="1"
                            Content="Gönder"
                            Command="{Binding AskQuestionCommand}"
                            Margin="8,0,0,0"/>
                </Grid>
            </Grid>
        </materialDesign:Card>
        </Grid>
        
        <!-- Saved Videos Sidebar -->
        <materialDesign:Card Grid.Column="1" Padding="16">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <TextBlock Grid.Row="0" 
                          Text="Kaydedilen Videolar" 
                          FontSize="16" 
                          FontWeight="SemiBold" 
                          Margin="0,0,0,12"/>
                
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <ItemsControl ItemsSource="{Binding SavedVideos}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Command="{Binding DataContext.LoadSavedVideoCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                       CommandParameter="{Binding}"
                                       Style="{StaticResource MaterialDesignFlatButton}"
                                       HorizontalContentAlignment="Left"
                                       Margin="0,0,0,8"
                                       Padding="8">
                                    <StackPanel>
                                        <TextBlock Text="{Binding Title}" 
                                                  FontWeight="SemiBold" 
                                                  TextWrapping="Wrap"
                                                  FontSize="12"/>
                                        <TextBlock Text="{Binding DateAdded, StringFormat='dd/MM/yyyy HH:mm'}" 
                                                  Foreground="Gray" 
                                                  FontSize="10"
                                                  Margin="0,4,0,0"/>
                                    </StackPanel>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </materialDesign:Card>
    </Grid>
</Page>
